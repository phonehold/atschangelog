<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Atschangelog</title>
  <meta name="description" content="ats change log note">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Atschangelog</h1>
    </header>
    <div id="container">
      <p class="tagline">ats change log note</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/phonehold/atschangelog/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/phonehold/atschangelog/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/phonehold/atschangelog" class="code">View Atschangelog on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>
<a name="ats-changelog-%E8%B7%9F%E8%BF%9B" class="anchor" href="#ats-changelog-%E8%B7%9F%E8%BF%9B"><span class="octicon octicon-link"></span></a>ats ChangeLog 跟进</h1>

<h3>
<a name="ats-410-note" class="anchor" href="#ats-410-note"><span class="octicon octicon-link"></span></a>ATS 4.1.0 (Note)</h3>

<p><strong><a href="https://issues.apache.org/jira/browse/TS-2323">ts-2323</a></strong></p>

<pre><code> 添加 .include 指令

 remap.config 配置如下：

 .include /etc/trafficserver/baidu.conf

 baidu.conf 配置如下：(和正常remap中的规则一样)

 map http://www.baidu.com/  http://www.baidu.com/

 traffic_line -x 生效

 BTW: 如果只改变baidu.conf 内容，traffic_line -x 则不生效，只有改变remap.conf
 的修改时间才会生效。最有效的办法是 touch /etc/trafficserver/remap.conf
 然后再执行traffic_line -x
</code></pre>

<p><strong><a href="https://issues.apache.org/jira/browse/TS-2265">ts-2265</a></strong></p>

<pre><code>删除不用的日志字段
</code></pre>

<p><del>prob</del></p>

<p><del>prcb</del></p>

<p><del>cgid</del></p>

<p><code>CONFIG proxy.config.log.custom_logs_enabled INT 1</code> 配置customlog 的时候注意不能再引用这些字段 ()</p>

<p><strong><a href="TS-2245">ts-2245</a></strong></p>

<pre><code>增加4个 cache 控制项（解决内容重复缓存 ---&gt;content duplications in cache）
建议值为2 (安全选项，如果对自己的内容有更好的把握，可以设置为1 比如图片类的应用)
</code></pre>

<p>proxy.config.http.cache.ignore_accept_mismatch</p>

<p>Scope:  CONFIG</p>

<p>Type:   INT</p>

<p>Default:    0</p>

<p>Reloadable: Yes</p>

<p>When with a value of 1, Traffic Server serves documents from cache with a Content-Type: header that does not match the Accept: header of the request. If set to 2, this logic only happens in the absence of a Vary header in the cached response (which is the recommended and safe use).</p>

<p>Note This option should only be enabled with 1 if you’re having problems with caching and you origin server doesn’t set the Vary header. Alternatively, if the origin is incorrectly setting Vary: Accept or doesn’t respond with 406 (Not Acceptable), you can also enable this configuration with a `<code>1</code>.
proxy.config.http.cache.ignore_accept_language_mismatch</p>

<p>Scope:  CONFIG</p>

<p>Type:   INT</p>

<p>Default:    0</p>

<p>Reloadable: Yes</p>

<p>When enabled with a value of 1, Traffic Server serves documents from cache with a Content-Language: header that does not match the Accept-Language: header of the request. If set to 2, this logic only happens in the absence of a Vary header in the cached response (which is the recommended and safe use).</p>

<p>Note This option should only be enabled with 1 if you’re having problems with caching and you origin server doesn’t set the Vary header. Alternatively, if the origin is incorrectly setting Vary: Accept-Language or doesn’t respond with 406 (Not Acceptable), you can also enable this configuration with a `<code>1</code>.
proxy.config.http.cache.ignore_accept_encoding_mismatch</p>

<p>Scope:  CONFIG</p>

<p>Type:   INT</p>

<p>Default:    0</p>

<p>Reloadable: Yes</p>

<p>When enabled with a value of 1, Traffic Server serves documents from cache with a Content-Encoding: header that does not match the Accept-Encoding: header of the request. If set to 2, this logic only happens in the absence of a Vary header in the cached response (which is the recommended and safe use).</p>

<p>Note This option should only be enabled with 1 if you’re having problems with caching and you origin server doesn’t set the Vary header. Alternatively, if the origin is incorrectly setting Vary: Accept-Encoding or doesn’t respond with 406 (Not Acceptable) you can also enable this configuration with a `<code>1</code>.
proxy.config.http.cache.ignore_accept_charset_mismatch</p>

<p>Scope:  CONFIG</p>

<p>Type:   INT</p>

<p>Default:    0</p>

<p>Reloadable: Yes</p>

<p>When enabled with a value of 1, Traffic Server serves documents from cache with a Content-Type: header that does not match the Accept-Charset: header of the request. If set to 2, this logic only happens in the absence of a Vary header in the cached response (which is the recommended and safe use).</p>

<p>Note This option should only be enabled with 1 if you’re having problems with caching and you origin server doesn’t set the Vary header. Alternatively, if the origin is incorrectly setting Vary: Accept-Charset or doesn’t respond with 406 (Not Acceptable), you can also enable this configuration with a `<code>1</code>.</p>

<p><strong><a href="https://issues.apache.org/jira/browse/TS-2259">ts-2259</a></strong></p>

<p><strong>日志系统冗余备份</strong></p>

<p>使用 '|' 分割  在 logs_xml.config.</p>

<pre><code>&lt;CollationHosts = "host1:5000|host2:5000|host3:6000, 209.131.52.129:6000"/&gt;

当host1 挂掉，则使用host2 和host 3做为备份，日志会传到host2  如果host2 也挂掉，则传到host3 
直到host1 或host2 正常为止。



&lt;CollationHosts = "host1|host2|host3, host4|host5"&gt;


两组日志服务器  (host1|host2|host3)和 (host4|host5)

host2/host3 是host1的备份

host5 是host4的备份

所有的日志都会传到两组服务器中去，而两组服务器中，只会选择第一个链接的服务器做为传输机器。
</code></pre>

<p><strong><a href="https://issues.apache.org/jira/browse/TS-2008">ts-2008</a></strong></p>

<p>支持多条后缀规则</p>

<pre><code>dest_domain=www.test.com suffix=jpeg,js,css,html,bc,bd ttl-in-cache=1m
</code></pre>

<p>支持* 匹配</p>

<pre><code>dest_domain=www.test.com suffix=* ttl-in-cache=1m
</code></pre>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/phonehold" class="avatar"><img src="https://0.gravatar.com/avatar/3ffc2a34fe800ed1ce854f7bdcef5c43?d=https%3A%2F%2Fidenticons.github.com%2F969516094b342230ceaf065c844d82f3.png&amp;r=x&amp;s=60" width="48" height="48"/></a> <a href="https://github.com/phonehold">phonehold</a> maintains <a href="https://github.com/phonehold/atschangelog">Atschangelog</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br/>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/phonehold/atschangelog/tarball/master" class="tar">tar</a><a href="https://github.com/phonehold/atschangelog/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
